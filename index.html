<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ê≠°Ê®ÇËã±ÊñáÊãºÂ≠óÁéã | Joyful Spelling Bee</title>
    <style>
        :root {
            --primary-color: #FFD93D; /* ‰∫ÆÈªÉ */
            --secondary-color: #4D96FF; /* Â§©Á©∫Ëóç */
            --accent-color: #FF6B6B; /* Ê¥ªÂäõÁ¥Ö */
            --success-color: #6BCB77; /* ÊàêÂäüÁ∂† */
            --text-color: #333;
            --bg-color: #F0F4F8;
            --card-bg: #FFFFFF;
            --font-main: 'Comic Sans MS', 'Chalkboard SE', sans-serif; /* Á´•Ë∂£Â≠óÈ´î */
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Header Area */
        header {
            background-color: var(--secondary-color);
            color: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
            z-index: 10;
        }

        h1 {
            margin: 0 0 10px 0;
            font-size: 1.5rem;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        select {
            padding: 8px 12px;
            border-radius: 20px;
            border: 2px solid white;
            background: white;
            font-family: inherit;
            font-size: 0.9rem;
            outline: none;
            cursor: pointer;
        }

        /* Tabs */
        .tabs {
            display: flex;
            justify-content: center;
            background: white;
            padding: 10px 5px;
            gap: 10px;
            position: sticky;
            top: 0;
            z-index: 5;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .tab-btn {
            background: #eee;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-family: inherit;
            font-weight: bold;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            flex: 1;
            max-width: 120px;
            white-space: nowrap;
        }

        .tab-btn.active {
            background: var(--primary-color);
            color: #333;
            transform: scale(1.05);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* Main Container */
        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }

        /* Card Style */
        .word-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px 20px;
            width: 100%;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            text-align: center;
            margin-bottom: 20px;
            position: relative;
            border: 5px solid var(--primary-color);
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .progress-bar {
            width: 100%;
            text-align: right;
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }

        /* Word Display Styles */
        .big-word {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 20px 0;
            word-break: break-word;
            line-height: 1.4;
        }

        .vowel { color: var(--accent-color); }
        .consonant { color: var(--secondary-color); }
        
        .syllable-dot {
            color: #ccc;
            margin: 0 2px;
            font-size: 1.5rem;
        }

        .chinese-def {
            font-size: 1.4rem;
            color: #555;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .example-sentence {
            font-size: 1rem;
            color: #777;
            font-style: italic;
            margin-top: 10px;
            background: #f9f9f9;
            padding: 10px;
            border-radius: 10px;
            width: 90%;
        }

        /* Interactive Elements */
        .btn-speak {
            background: var(--secondary-color);
            color: white;
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 0 #2c7be5;
            transition: transform 0.1s;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-speak:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* Mode B: Blocks */
        .scramble-area {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .letter-block {
            background: white;
            border: 2px solid var(--secondary-color);
            color: var(--secondary-color);
            font-size: 1.5rem;
            width: 45px;
            height: 45px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 3px 0 #ccc;
            user-select: none;
        }

        .letter-block:active {
            transform: translateY(3px);
            box-shadow: none;
        }

        .letter-block.used {
            opacity: 0.3;
            cursor: default;
            transform: none;
            box-shadow: none;
            border-color: #ccc;
        }

        .answer-area {
            min-height: 50px;
            border-bottom: 3px dashed #ccc;
            display: flex;
            gap: 5px;
            justify-content: center;
            margin-bottom: 20px;
            padding: 5px;
            width: 90%;
            flex-wrap: wrap;
        }

        /* Mode C: Input */
        .input-box {
            font-size: 1.5rem;
            padding: 10px;
            width: 80%;
            text-align: center;
            border: 3px solid #ccc;
            border-radius: 10px;
            outline: none;
            font-family: inherit;
            margin-top: 20px;
        }
        
        .input-box:focus {
            border-color: var(--secondary-color);
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            width: 100%;
            justify-content: center;
        }

        .btn-nav {
            padding: 12px 30px;
            font-size: 1.1rem;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            font-family: inherit;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn-prev { background: #e0e0e0; color: #555; }
        .btn-next { background: var(--primary-color); color: #333; }
        .btn-check { background: var(--success-color); color: white; display: none; }

        .btn-toggle-syllable {
            background: transparent;
            border: 1px solid #999;
            color: #666;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-top: 5px;
            cursor: pointer;
        }

        /* Feedback Animation */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        .shake { animation: shake 0.4s; }
        
        .feedback-msg {
            height: 30px;
            margin-top: 10px;
            font-weight: bold;
            font-size: 1.2rem;
        }
        .correct { color: var(--success-color); }
        .incorrect { color: var(--accent-color); }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .big-word { font-size: 2rem; }
            .letter-block { width: 38px; height: 38px; font-size: 1.2rem; }
            .tabs { padding: 10px 0; }
            .tab-btn { padding: 8px 10px; font-size: 0.85rem; }
            .controls select { width: 140px; }
        }
    </style>
</head>
<body>

<header>
    <h1>‚úàÔ∏è Ê≠°Ê®ÇËã±ÊñáÊãºÂ≠óÁéã</h1>
    <div class="controls">
        <select id="voiceSelect">
            <option value="">ËºâÂÖ•Ë™ûÈü≥‰∏≠...</option>
        </select>
        <select id="levelSelect">
            <option value="all">ÂÖ®ÈÉ®ÂñÆÂ≠ó</option>
            <option value="1" selected>Level 1 (Âü∫Á§é)</option>
            <option value="2">Level 2 (È£ØÂ∫ó)</option>
            <option value="3">Level 3 (ÁîüÊ¥ª)</option>
        </select>
    </div>
</header>

<div class="tabs">
    <button class="tab-btn active" onclick="setMode('learn')">üìñ Â≠∏ÁøíÂç°</button>
    <button class="tab-btn" onclick="setMode('block')">üß© ÊãºÁ©çÊú®</button>
    <button class="tab-btn" onclick="setMode('dictation')">‚úçÔ∏è ËÅΩÂØ´</button>
</div>

<div class="container">
    <div class="progress-bar">
        ÂñÆÂ≠ó: <span id="currentIndex">1</span> / <span id="totalCount">10</span>
    </div>

    <div class="word-card" id="cardArea">
        <!-- Dynamic Content will be injected here -->
    </div>

    <div class="feedback-msg" id="feedback"></div>

    <div class="nav-buttons">
        <button class="btn-nav btn-prev" onclick="prevWord()">‰∏ä‰∏ÄÂºµ</button>
        <button class="btn-nav btn-check" id="checkBtn" onclick="checkAnswer()">Ê™¢Êü•Á≠îÊ°à</button>
        <button class="btn-nav btn-next" id="nextBtn" onclick="nextWord()">‰∏ã‰∏ÄÂºµ</button>
    </div>
</div>

<script>
    // --- Data Source ---
    const allWords = [
        // Level 1: Travel Basics
        { word: "Passport", syllables: ["Pass", "port"], zh: "Ë≠∑ÁÖß", sentence: "Don't forget to bring your passport." },
        { word: "Boarding pass", syllables: ["Board", "ing", "pass"], zh: "ÁôªÊ©üË≠â", sentence: "Please show me your boarding pass." },
        { word: "Terminal", syllables: ["Ter", "mi", "nal"], zh: "Ëà™Âªà", sentence: "Our flight leaves from Terminal 2." },
        { word: "Baggage claim", syllables: ["Bag", "gage", "claim"], zh: "Ë°åÊùéÊèêÈ†òËôï", sentence: "Let's go to baggage claim to get our bags." },
        { word: "Customs", syllables: ["Cus", "toms"], zh: "Êµ∑Èóú", sentence: "We need to go through customs now." },
        { word: "Reservation", syllables: ["Res", "er", "va", "tion"], zh: "È†êË®Ç", sentence: "I have a reservation for two nights." },
        { word: "Check-in", syllables: ["Check", "in"], zh: "Ëæ¶ÁêÜÂÖ•‰Ωè", sentence: "Check-in time is at 3 PM." },
        { word: "Front desk", syllables: ["Front", "desk"], zh: "Ê´ÉÂè∞", sentence: "Please call the front desk properly." },
        { word: "Deposit", syllables: ["De", "pos", "it"], zh: "ÊäºÈáë", sentence: "You need to pay a deposit for the key." },
        { word: "Amenities", syllables: ["A", "men", "i", "ties"], zh: "È£ØÂ∫óË®≠ÊñΩ/ÂÇôÂìÅ", sentence: "The hotel has great amenities like a pool." },
        
        // Level 2: Transport & Location
        { word: "Platform", syllables: ["Plat", "form"], zh: "ÊúàÂè∞", sentence: "The train is arriving at Platform 5." },
        { word: "Fare", syllables: ["Fare"], zh: "Á•®ÂÉπ", sentence: "How much is the bus fare?" },
        { word: "Transfer", syllables: ["Trans", "fer"], zh: "ËΩâ‰πò", sentence: "We need to transfer to the red line." },
        { word: "Subway", syllables: ["Sub", "way"], zh: "Âú∞Èêµ", sentence: "The subway is the fastest way to travel." },
        { word: "Destination", syllables: ["Des", "ti", "na", "tion"], zh: "ÁõÆÁöÑÂú∞", sentence: "Our final destination is Paris." },
        { word: "Menu", syllables: ["Men", "u"], zh: "ËèúÂñÆ", sentence: "Can I see the menu, please?" },
        { word: "Recommendation", syllables: ["Rec", "om", "men", "da", "tion"], zh: "Êé®Ëñ¶", sentence: "Do you have any recommendations?" },
        { word: "Bill", syllables: ["Bill"], zh: "Â∏≥ÂñÆ", sentence: "Can we have the bill, please?" },
        { word: "Take away", syllables: ["Take", "a", "way"], zh: "Â§ñÂ∏∂", sentence: "I'd like to order this to take away." },
        { word: "Vegetarian", syllables: ["Veg", "e", "tar", "i", "an"], zh: "Á¥†È£üËÄÖ", sentence: "Is there a vegetarian option?" },

        // Level 3: Shopping & Needs
        { word: "Receipt", syllables: ["Re", "ceipt"], zh: "Êî∂Êìö", sentence: "Here is your receipt." },
        { word: "Tax refund", syllables: ["Tax", "re", "fund"], zh: "ÈÄÄÁ®Ö", sentence: "Where can I get a tax refund?" },
        { word: "Discount", syllables: ["Dis", "count"], zh: "ÊäòÊâ£", sentence: "Is there a student discount?" },
        { word: "Cash", syllables: ["Cash"], zh: "ÁèæÈáë", sentence: "I only have cash on me." },
        { word: "Currency", syllables: ["Cur", "ren", "cy"], zh: "Ë≤®Âπ£", sentence: "What is the local currency?" },
        { word: "Restroom", syllables: ["Rest", "room"], zh: "Ê¥óÊâãÈñì", sentence: "Excuse me, where is the restroom?" },
        { word: "Pharmacy", syllables: ["Phar", "ma", "cy"], zh: "Ëó•Â±Ä", sentence: "I need to buy medicine at the pharmacy." },
        { word: "Adapter", syllables: ["A", "dap", "ter"], zh: "ËΩâÊé•È†≠", sentence: "Do you have a power adapter?" },
        { word: "Emergency", syllables: ["E", "mer", "gen", "cy"], zh: "Á∑äÊÄ•ÊÉÖÊ≥Å", sentence: "Call 911 in case of an emergency." },
        { word: "Charger", syllables: ["Charg", "er"], zh: "ÂÖÖÈõªÂô®", sentence: "May I borrow your phone charger?" }
    ];

    // --- State Management ---
    let currentMode = 'learn'; // learn, block, dictation
    let currentLevelWords = [];
    let currentIndex = 0;
    let showSyllables = false;
    let synth = window.speechSynthesis;
    let voices = [];
    let userAnswer = ""; // For block mode

    // --- DOM Elements ---
    const cardArea = document.getElementById('cardArea');
    const levelSelect = document.getElementById('levelSelect');
    const voiceSelect = document.getElementById('voiceSelect');
    const checkBtn = document.getElementById('checkBtn');
    const nextBtn = document.getElementById('nextBtn');
    const feedbackEl = document.getElementById('feedback');
    const tabBtns = document.querySelectorAll('.tab-btn');

    // --- Initialization ---
    window.onload = () => {
        loadVoices();
        filterWordsByLevel();
        renderCard();
    };

    // Voice Loading (Handles browser async loading)
    function loadVoices() {
        voices = synth.getVoices();
        if (voices.length > 0) populateVoiceList();
        else synth.onvoiceschanged = () => {
            voices = synth.getVoices();
            populateVoiceList();
        };
    }

    function populateVoiceList() {
        voiceSelect.innerHTML = '';
        
        // Priority sorting: English US/UK first
        voices.sort((a, b) => {
            const aName = a.name.toLowerCase();
            const bName = b.name.toLowerCase();
            if (aName.includes('google us') || aName.includes('english united states')) return -1;
            if (bName.includes('google us') || bName.includes('english united states')) return 1;
            return 0;
        });

        voices.forEach((voice) => {
            if(voice.lang.includes('en')) { // Filter only English voices for cleaner UI
                const option = document.createElement('option');
                option.textContent = `${voice.name} (${voice.lang})`;
                option.value = voice.name;
                voiceSelect.appendChild(option);
            }
        });
        
        // Attempt to select a good default
        const defaultVoice = voices.find(v => v.name.includes("Google US English")) || voices.find(v => v.lang === "en-US");
        if(defaultVoice) voiceSelect.value = defaultVoice.name;
    }

    // --- Level Logic ---
    levelSelect.addEventListener('change', () => {
        filterWordsByLevel();
        currentIndex = 0;
        renderCard();
    });

    function filterWordsByLevel() {
        const level = levelSelect.value;
        if (level === 'all') {
            currentLevelWords = [...allWords];
        } else {
            const start = (parseInt(level) - 1) * 10;
            currentLevelWords = allWords.slice(start, start + 10);
        }
        document.getElementById('totalCount').textContent = currentLevelWords.length;
    }

    // --- Mode Switching ---
    function setMode(mode) {
        currentMode = mode;
        
        // Update Tabs UI
        tabBtns.forEach(btn => btn.classList.remove('active'));
        if(mode === 'learn') tabBtns[0].classList.add('active');
        if(mode === 'block') tabBtns[1].classList.add('active');
        if(mode === 'dictation') tabBtns[2].classList.add('active');

        // Button visibility logic
        if (mode === 'learn') {
            checkBtn.style.display = 'none';
            nextBtn.style.display = 'block';
        } else {
            checkBtn.style.display = 'block';
            nextBtn.style.display = 'none'; // Require check before next
        }

        renderCard();
    }

    // --- Core Rendering ---
    function renderCard() {
        const wordObj = currentLevelWords[currentIndex];
        document.getElementById('currentIndex').textContent = currentIndex + 1;
        feedbackEl.textContent = "";
        feedbackEl.className = "feedback-msg";
        
        // Clean up previous state
        userAnswer = "";

        let html = '';

        // Common Audio Button
        html += `<button class="btn-speak" onclick="speakWord()"><span style="font-size:2rem">üîä</span></button>`;
        
        if (currentMode === 'learn') {
            // MODE A: Learning
            html += `<div class="big-word">${formatColoredWord(wordObj)}</div>`;
            html += `<button class="btn-toggle-syllable" onclick="toggleSyllables()">
                        ${showSyllables ? 'Èö±ËóèÈü≥ÁØÄ' : 'È°ØÁ§∫Èü≥ÁØÄÊãÜËß£'}
                     </button>`;
            html += `<div class="chinese-def">${wordObj.zh}</div>`;
            html += `<div class="example-sentence">${wordObj.sentence}</div>`;
            checkBtn.style.display = 'none';
            nextBtn.style.display = 'block';

        } else if (currentMode === 'block') {
            // MODE B: Blocks
            html += `<div class="chinese-def">${wordObj.zh}</div>`;
            html += `<div class="answer-area" id="blockAnswerArea"></div>`;
            html += `<div class="scramble-area" id="scrambleArea"></div>`;
            nextBtn.style.display = 'none'; // Hide next until correct
            setTimeout(() => setupBlockGame(wordObj.word), 50); // Delay for DOM insert

        } else if (currentMode === 'dictation') {
            // MODE C: Dictation
            html += `<div class="chinese-def">${wordObj.zh}</div>`;
            html += `<input type="text" id="dictationInput" class="input-box" placeholder="Ëº∏ÂÖ•ÂñÆÂ≠ó..." autocomplete="off">`;
            nextBtn.style.display = 'none';
        }

        cardArea.innerHTML = html;

        // Auto speak on mode change or new word (except Learn mode might be annoying, let's keep it manual or auto-once)
        if(currentMode !== 'learn') {
            // speakWord(); // Optional: Auto speak on load for challenge modes
        }
    }

    // --- Helper: Format Word with Colors ---
    function formatColoredWord(wordObj) {
        if (showSyllables) {
            // Render by syllables
            return wordObj.syllables.map(syl => {
                return colorizeText(syl);
            }).join('<span class="syllable-dot">¬∑</span>');
        } else {
            // Render whole word
            return colorizeText(wordObj.word);
        }
    }

    function colorizeText(text) {
        const vowels = ['a','e','i','o','u','A','E','I','O','U'];
        let result = '';
        for (let char of text) {
            if (vowels.includes(char)) {
                result += `<span class="vowel">${char}</span>`;
            } else if (/[a-zA-Z]/.test(char)) {
                result += `<span class="consonant">${char}</span>`;
            } else {
                result += char; // Symbols like hyphens or spaces
            }
        }
        return result;
    }

    function toggleSyllables() {
        showSyllables = !showSyllables;
        renderCard();
    }

    // --- Helper: Block Game Logic ---
    function setupBlockGame(word) {
        const scrambleArea = document.getElementById('scrambleArea');
        const cleanWord = word; // Keep spaces and hyphens
        
        // Create array of characters including ID for uniqueness
        let chars = cleanWord.split('').map((char, index) => ({ char, id: index }));
        
        // Shuffle
        for (let i = chars.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [chars[i], chars[j]] = [chars[j], chars[i]];
        }

        scrambleArea.innerHTML = '';
        chars.forEach(item => {
            const btn = document.createElement('div');
            btn.className = 'letter-block';
            btn.textContent = item.char;
            if(item.char === ' ') btn.style.width = '30px'; // Visual fix for space
            
            btn.onclick = () => {
                if (btn.classList.contains('used')) return;
                addBlockAnswer(item, btn);
            };
            scrambleArea.appendChild(btn);
        });
    }

    function addBlockAnswer(item, sourceBtn) {
        const answerArea = document.getElementById('blockAnswerArea');
        const block = document.createElement('div');
        block.className = 'letter-block';
        block.textContent = item.char;
        block.style.background = '#eef';
        
        // Allow removing from answer
        block.onclick = () => {
            block.remove();
            sourceBtn.classList.remove('used');
            userAnswer = getCurrentBlockAnswer();
        };

        answerArea.appendChild(block);
        sourceBtn.classList.add('used');
        userAnswer = getCurrentBlockAnswer();
    }

    function getCurrentBlockAnswer() {
        const blocks = document.querySelectorAll('#blockAnswerArea .letter-block');
        let ans = "";
        blocks.forEach(b => ans += b.textContent);
        return ans;
    }

    // --- TTS Function ---
    function speakWord() {
        const word = currentLevelWords[currentIndex].word;
        if (synth.speaking) {
            synth.cancel();
        }
        const utterThis = new SpeechSynthesisUtterance(word);
        
        const selectedOption = voiceSelect.selectedOptions[0]?.getAttribute('value');
        if (selectedOption) {
            utterThis.voice = voices.find(v => v.name === selectedOption);
        }
        
        utterThis.rate = 0.9; // Slightly slower for kids
        synth.speak(utterThis);
    }

    // --- Navigation & Checking ---
    function prevWord() {
        if (currentIndex > 0) {
            currentIndex--;
            renderCard();
        }
    }

    function nextWord() {
        if (currentIndex < currentLevelWords.length - 1) {
            currentIndex++;
            renderCard();
        }
    }

    function checkAnswer() {
        const currentWord = currentLevelWords[currentIndex].word;
        let input = "";

        if (currentMode === 'block') {
            input = userAnswer;
        } else if (currentMode === 'dictation') {
            input = document.getElementById('dictationInput').value;
        }

        // Normalize checks (ignore case)
        if (input.toLowerCase().trim() === currentWord.toLowerCase().trim()) {
            feedbackEl.textContent = "Correct! üéâ Â§™Ê£í‰∫ÜÔºÅ";
            feedbackEl.className = "feedback-msg correct";
            // Play nice sound logic (optional, sticking to requested speech API)
            const goodJob = new SpeechSynthesisUtterance("Good job!");
            synth.speak(goodJob);
            
            checkBtn.style.display = 'none';
            nextBtn.style.display = 'block';
        } else {
            feedbackEl.textContent = "Try again! üí™ ÂÜçË©¶‰∏ÄÊ¨°";
            feedbackEl.className = "feedback-msg incorrect shake";
            setTimeout(() => feedbackEl.classList.remove('shake'), 500);
        }
    }

    // Enable Enter key for dictation
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && currentMode === 'dictation') {
            checkAnswer();
        }
    });

</script>

</body>
</html>
